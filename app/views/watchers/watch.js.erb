!(function($) {
  var watchButtons = $('.button[data-unwatch-text]');
  watchButtons.each(function updateTextAndIcon(_, el) {
    var button = $(el),
        text = button.data('unwatch-text'),
        icon = button.data('unwatch-icon'),
        oldIcon = button.data('watch-icon'),
        path = button.data('unwatch-path'),
        method = button.data('unwatch-method');

    button.find('span.button--text').text(text);
    button.find('i.button--icon').removeClass('icon-' + oldIcon).addClass('icon-' + icon);
    button.attr('href', path).data('method', method);

    <% if User.current.allowed_to?(:view_work_package_watchers, @project) && @watched.is_a?(WorkPackage) %>
    // replace the watchers panel
    var watchersPanel = $('#watchers');
    if (!watchersPanel) {
      return;
    }
    watchersPanel.html('<%=j render partial: "watchers/watchers", locals: { watched: @watched } %>');
    <% end %>
  });
}(jQuery));
