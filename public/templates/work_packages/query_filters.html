<fieldset id="filters" class="work-packages-filters--container">
  <legend>
    <a href>
      <span ng-bind="I18n.t('js.work_packages.label_filter_add')"/>
    </a>
  </legend>

  <div class="filter-fields">
    <table width="100%" class="work-packages-filters--filter-table">
      <tbody>
        <tr>
          <td>

            <table>
              <tbody>
                <tr query-filter
                    ng-repeat="filter in query.filters"
                    bindonce="filter"
                    ng-show="!filter.deactivated"
                    bo-attr
                    bo-attr-id="'tr_' + filter.name"
                    class="filter">

                  <!-- Hidden for form -->
                  <input bo-attr
                         bo-attr-id="'h_' + filter.name"
                         bo-attr-value="filter.name"
                         name="f[]"
                         type="hidden"
                         ng-disabled="filter.deactivated"/>

                  <!-- Name -->
                  <td style="width:200px;"
                      bo-text="localisedFilterName(query.availableWorkPackageFilters[filter.name])"></td>

                  <!-- Operator -->
                  <td style="width:150px;">
                    <label class="hidden-for-sighted"
                           bo-attr
                           bo-attr-for="'operators_' + filter.name"
                           bo-text="I18n.t('js.work_packages.description_filter')"></label>
                    <select require
                            class="select-small"
                            bo-attr
                            bo-attr-id="'operators-' + filter.name"
                            bo-attr-name="'op[' + filter.name + ']'"
                            ng-model="filter.operator"
                            style="vertical-align: top;"
                            ng-disabled="isLoading">

                      <option ng-repeat="option in operatorsAndLabelsByFilterType[filter.type]"
                              bo-attr
                              bo-attr-value="option[0]"
                              ng-selected="option[0] == filter.operator"
                              bo-text="I18n.t('js.' + option[1])"></option>
                    </select>
                  </td>

                  <!-- Values -->
                  <td>
                    <div bo-attr
                         bo-attr-id="'div-values-' + filter.name"
                         ng-if="!showValueOptionsAsSelect"
                         ng-show="showValuesInput"
                         bo-switch="filter.type">
                      <input bo-switch-when="string"
                             bo-attr
                             bo-attr-id="'values-' + filter.name"
                             bo-attr-name="'v[' + filter.name + ']'"
                             ng-model="filter.textValue"
                             ng-minlength="3"
                             ng-required="true"
                             class="select-small"
                             size="30"
                             type="text"
                             value=""
                             ng-disabled="isLoading"
                             execute-on-enter="updateResults()"/>
                      <label bo-switch-when="string"
                             bo-attr
                             bo-attr-for="'values_' + name"
                             class="hidden-for-sighted"
                             bo-text="I18n.t('js.work_packages.description_enter_text')"/>

                      <input bo-switch-when="text"
                             bo-attr
                             bo-attr-id="'values-' + filter.name"
                             bo-attr-name="'v[' + filter.name + ']'"
                             ng-model="filter.textValue"
                             ng-minlength="3"
                             ng-required="true"
                             class="select-small"
                             size="30"
                             type="text"
                             value=""
                             ng-disabled="isLoading"
                             execute-on-enter="updateResults()"/>
                      <label bo-switch-when="'text'"
                             bo-attr
                             bo-attr-for="'values_' + name"
                             class="hidden-for-sighted"
                             bo-text="I18n.t('js.work_packages.description_enter_text')"/>

                      <input bo-switch-when="integer"
                             bo-attr
                             bo-attr-id="'values-' + filter.name"
                             bo-attr-name="'v[' + filter.name + ']'"
                             ng-model="filter.textValue"
                             ng-required="true"
                             class="select-small"
                             min="0"
                             type="number"
                             value=""
                             ng-disabled="isLoading"
                             execute-on-enter="updateResults()"/>
                      <label bo-switch-when="'integer'"
                             bo-attr
                             bo-attr-for="'values_' + name"
                             class="hidden-for-sighted"
                             bo-text="I18n.t('js.work_packages.description_enter_text')"/>

                      <input bo-switch-when="date"
                             bo-attr
                             bo-attr-id="'values-' + filter.name"
                             bo-attr-name="'v[' + filter.name + ']'"
                             ng-model="filter.textValue"
                             ng-required="true"
                             class="select-small"
                             size="3"
                             type="text"
                             ng-disabled="isLoading"
                             execute-on-enter="updateResults()"/>
                      <label bo-switch-when="date"
                             bo-attr
                             bo-attr-for="'values_' + name"
                             class="hidden-for-sighted"
                             bo-text="I18n.t('js.work_packages.time_relative.days')"/>
                      <label bo-switch-when="date"
                             bo-attr
                             bo-attr-for="'values_' +name"
                             bo-text="I18n.t('js.work_packages.time_relative.days')"/>

                      <input bo-switch-when="date_past"
                             bo-attr
                             bo-attr-id="'values-' + filter.name"
                             bo-attr-name="'v[' + filter.name + ']'"
                             ng-model="filter.textValue"
                             ng-required="true"
                             class="select-small"
                             size="3"
                             type="text"
                             ng-disabled="isLoading"
                             execute-on-enter="updateResults()"/>
                      <label bo-switch-when="date_past"
                             bo-attr
                             bo-attr-for="'values_' + name"
                             class="hidden-for-sighted"
                             bo-text="I18n.t('js.work_packages.time_relative.days')"/>
                      <label bo-switch-when="date_past"
                             bo-attr
                             bo-attr-for="'values_' + name"
                             bo-text="I18n.t('js.work_packages.time_relative.days')"/>
                    </div>

                    <div ng-if="showValueOptionsAsSelect"
                         ng-show="showValuesInput">
                      <toggled-multiselect available-options="availableFilterValueOptions"
                                           name="filter.name"
                                           values="filter.values"
                                           is-multiselect="false"
                                           isDisabled="isLoading"/>

                    </div>
                  </td>

                  <!-- Delete filter -->
                  <td>
                    <icon-wrapper icon-name="delete2"
                                  icon-title="{{I18n.t('js.button_delete')}}"
                                  ng-click="query.deactivateFilter(filter)"/>
                    <!-- TODO I18n -->
                  </td>
                </tr>

              </tbody>
            </table>
          </td>

          <!-- Add filters -->

          <td class="add-filter">

            <label for="add_filter_select">{{ I18n.t('js.work_packages.label_filter_add') }}</label>:
            <select class="select-small"
                    id="add_filter_select"
                    ng-model="filterToBeAdded"
                    ng-options="filterName as localisedFilterName(query.availableWorkPackageFilters[filterName])
                                for filterName
                                in query.availableWorkPackageFilters | remainingFilterNames:query.filters" />
            </select>
            <!-- TODO options | orderObjectBy: 'order' -->
          </td>

        </tr>
      </tbody>
    </table>

    <input id="f_" name="f[]" type="hidden" value=""/>

  </div>
</fieldset>
